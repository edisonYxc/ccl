<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of demo_toy_example_2D</title>
  <meta name="keywords" content="demo_toy_example_2D">
  <meta name="description" content="demo_toy_example_2D">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">Functions</a> &gt; <a href="index.html">demos</a> &gt; demo_toy_example_2D.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Functions\demos&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>demo_toy_example_2D
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>demo_toy_example_2D</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function demo_toy_example_2D </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> demo_toy_example_2D
 This demo demonstrates a toy 2D problem for the usage of the CCL library.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>	data = generate_alpha_ccl (settings)</li><li><a href="../../Functions/evaluation/get_ncpe.html" class="code" title="function [ncpe, v, mse] = get_ncpe(F, Fp, P)">get_ncpe</a>	[ncpe, v, mse] = get_ncpe(F, Fp, P)</li><li><a href="../../Functions/evaluation/get_npe.html" class="code" title="function [umse, variance, nmse] = get_npe (U, Unp)">get_npe</a>	[umse, variance, nmse] = get_npe (U, Unp)</li><li><a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>	[nupe, v, mse] = get_nupe(F, Fp)</li><li><a href="../../Functions/evaluation/get_poe.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe(U_t, N_p, Pi)">get_poe</a>	[nPOE, vPOE, uPOE] = get_poe(U_t, N_p, Pi)</li><li><a href="../../Functions/evaluation/get_poe_alpha.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe_alpha (f_proj, X, NS_t)">get_poe_alpha</a>	[nPOE, vPOE, uPOE] = get_poe_alpha (f_proj, X, NS_t)</li><li><a href="../../Functions/evaluation/get_ppe.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe(U_t, N_p, Pi)">get_ppe</a>	[nPPE, vPPE, uPPE] = get_ppe(U_t, N_p, Pi)</li><li><a href="../../Functions/evaluation/get_ppe_alpha.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe_alpha (f_proj, X_t, Pi, NS_t)">get_ppe_alpha</a>	[nPPE, vPPE, uPPE] = get_ppe_alpha (N_p, X_t, Pi, NS_t)</li><li><a href="../../Functions/learn_constraint/learn_alpha_ccl.html" class="code" title="function [optimal] = learn_alpha_ccl (Un, X, options)">learn_alpha_ccl</a>	[optimal] = learn_alpha_ccl (Un, X, options)</li><li><a href="../../Functions/learn_constraint/learn_nhat.html" class="code" title="function [optimal, result] = learn_nhat (Un)">learn_nhat</a>	[optimal, result] = learn_nhat (Un)</li><li><a href="../../Functions/learn_nullspace_component/learn_ncl.html" class="code" title="function model = learn_ncl(X, Y, model)">learn_ncl</a>	model = learn_ncl(X, Y, model)</li><li><a href="../../Functions/learn_policy/learn_ccl_pi.html" class="code" title="function model = learn_ccl_pi(X,Y,model)">learn_ccl_pi</a>	model = learn_ccl_pi(X,Y,model)</li><li><a href="../../Functions/learn_policy/learn_lwccl.html" class="code" title="function model = learn_lwccl(X,Y,model)">learn_lwccl</a>	model = learn_ccl(X,Y,model)</li><li><a href="../../Functions/prediction/predict_linear.html" class="code" title="function Yp = predict_linear(X,model)">predict_linear</a>	Yp = predict_linear(X,model)</li><li><a href="../../Functions/prediction/predict_local_linear.html" class="code" title="function Yp = predict_local_linear(X,model)">predict_local_linear</a>	Yp = predict_local_linear(X,model)</li><li><a href="../../Functions/prediction/predict_ncl.html" class="code" title="function Unp = predict_ncl ( model, X )">predict_ncl</a>	Unp = predict_ncl ( model, X )</li><li><a href="../../Functions/prediction/predict_proj.html" class="code" title="function Yp = predict_proj (F,model)">predict_proj</a>	Yp = predict_proj (F,model)</li><li><a href="../../Functions/subfunctions/distances.html" class="code" title="function D = distances (A, B)">distances</a>	D = distances (A,B)</li><li><a href="../../Functions/subfunctions/generate_grid_centres.html" class="code" title="function centres = generate_grid_centres(X, num_basis )">generate_grid_centres</a>	centres = generate_grid_centres(X, num_basis )</li><li><a href="../../Functions/subfunctions/phi_gaussian_rbf.html" class="code" title="function BX = phi_gaussian_rbf ( X, C, s2 )">phi_gaussian_rbf</a>	BX = phi_gaussian_rbf ( X, C, s2 )</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function demo_toy_example_2D</a>
0002 <span class="comment">% demo_toy_example_2D</span>
0003 <span class="comment">% This demo demonstrates a toy 2D problem for the usage of the CCL library.</span>
0004 clear all;clc;close all;rng(<span class="string">'default'</span>);
0005 fprintf(<span class="string">'&lt;=========================================================================&gt;\r'</span>);
0006 fprintf(<span class="string">'&lt;=========================================================================&gt;\r'</span>);
0007 fprintf(<span class="string">'&lt;===========   Constraint Consistent Learning Library    =================&gt;\r'</span>);
0008 fprintf(<span class="string">'&lt; This demo will go through a Toy example to demonstrate this CCL toolbox &gt;\r'</span>);
0009 fprintf(<span class="string">'&lt; The CCL is formulated in the following format:                          &gt; \r'</span>);
0010 fprintf(<span class="string">'&lt; Consider the set of consistent k-dimensional constraints:               &gt;\r'</span>);
0011 fprintf(<span class="string">'&lt;                  A(x)U(x) = b(x)                                        &gt;\r'</span>);
0012 fprintf(<span class="string">'&lt;                      U(x) = pinv(A(x))b(x) + (I-pinv(A(x))A(x))Pi(x)    &gt;\r'</span>);
0013 fprintf(<span class="string">'&lt;                      U(x) =      U_ts      +         U_ns               &gt;\r'</span>);
0014 fprintf(<span class="string">'&lt; The task is defined in 2D. The constraints are either random or state   &gt;\r'</span>);
0015 fprintf(<span class="string">'&lt; dependant parabola. The null space control policies are either linear   &gt;\r'</span>);
0016 fprintf(<span class="string">'&lt; attractor or limit cycle. This demo will execute section by section and &gt;\r'</span>);
0017 fprintf(<span class="string">'&lt; allow the user to configure the training parameters.                    &gt;\r'</span>);
0018 fprintf(<span class="string">'&lt; List of sections:                                                       &gt;\r'</span>);
0019 fprintf(<span class="string">'&lt; SECTION 1:       PARAMETER CONFIGURATION                                &gt;\r'</span>);
0020 fprintf(<span class="string">'&lt; SECTION 2:       LEARNING NULL SPACE COMPONENTS                         &gt;\r'</span>);
0021 fprintf(<span class="string">'&lt; SECTION 3:       LEARNING NULL SPACE CONSTRAINTS                        &gt;\r'</span>);
0022 fprintf(<span class="string">'&lt; SECTION 4:       LEARNING NULL SPACE POLICY                             &gt;\r'</span>);
0023 fprintf(<span class="string">'&lt; Configuration options:                                                  &gt;\r'</span>);
0024 fprintf(<span class="string">'&lt; Constraints:                                                            &gt;\r'</span>);
0025 fprintf(<span class="string">'&lt;            State independant:                                           &gt;\r'</span>);
0026 fprintf(<span class="string">'&lt;                              linear (random)                            &gt;\r'</span>);
0027 fprintf(<span class="string">'&lt;              State dependant:                                           &gt;\r'</span>);
0028 fprintf(<span class="string">'&lt;                              parabola                                   &gt;\r'</span>);
0029 fprintf(<span class="string">'&lt; Null space policy:                                                      &gt;\r'</span>);
0030 fprintf(<span class="string">'&lt;                  linear attractor                                       &gt;\r'</span>);
0031 fprintf(<span class="string">'&lt;                  linear                                                 &gt;\r'</span>);
0032 fprintf(<span class="string">'&lt;                  limit cycle                                            &gt;\r'</span>);
0033 fprintf(<span class="string">'&lt; Task space policy:                                                      &gt;\r'</span>);
0034 fprintf(<span class="string">'&lt;                  random                                                 &gt;\n'</span>);
0035 fprintf(<span class="string">'&lt;=========================================================================&gt;\r'</span>);
0036 fprintf(<span class="string">'&lt;=========================================================================&gt;\r'</span>);
0037 fprintf(<span class="string">'&lt;=========================================================================&gt;\n\n\n'</span>);
0038 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0039 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0040 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0041 fprintf(<span class="string">'&lt; SECTION 1:       PARAMETER CONFIGURATION                                &gt;\r'</span>);
0042 fprintf(<span class="string">'\n&lt; User specified configurations are:                                      &gt;\r'</span>);
0043 <span class="comment">%% GENERATIVE MODEL PARAMETERS</span>
0044 ctr = .9*ones(1,3); lwtr = 1;                                   <span class="comment">% colour, linewidth for training data</span>
0045 cv  = [0  0  0];    lwv  = 1;                                   <span class="comment">% colour, linewidth for visualisation data</span>
0046 cpv = [1 .5 .5];    lwpv = 2;                                   <span class="comment">% colour, linewidth for visualisation data predictions</span>
0047 settings.dim_x          = 2 ;                                   <span class="comment">% dimensionality of the state space</span>
0048 settings.dim_u          = 2 ;                                   <span class="comment">% dimensionality of the action space</span>
0049 settings.dim_r          = 2 ;                                   <span class="comment">% dimensionality of the task space</span>
0050 settings.dim_k          = 1 ;                                   <span class="comment">% dimensionality of the constraint</span>
0051 settings.dt             = 0.1;                                  <span class="comment">% time step</span>
0052 settings.null.alpha     = 0.5 ;                                   <span class="comment">% null space policy scaling</span>
0053 settings.s2y  = .01;                                                     <span class="comment">% noise in output</span>
0054 xmax = ones(settings.dim_x,1); xmin=-xmax;                                <span class="comment">% range of data</span>
0055 
0056 settings.projection = <span class="string">'state_independant'</span>;                        <span class="comment">% {'state_independant' 'state_dependant'}</span>
0057 settings.task_policy_type = <span class="string">'random'</span>;                           <span class="comment">% {'random'}</span>
0058 settings.null_policy_type = <span class="string">'limit_cycle'</span>;                 <span class="comment">% {'limit_cycle' 'linear_attractor' 'linear'}</span>
0059 settings.control_space    = <span class="string">'end_effector'</span>;                     <span class="comment">% control space in end_effector</span>
0060 
0061 fprintf(<span class="string">'&lt; Dim_x             = %d                                                   &gt;\r'</span>,settings.dim_x);
0062 fprintf(<span class="string">'&lt; Dim_u             = %d                                                   &gt;\r'</span>,settings.dim_u);
0063 fprintf(<span class="string">'&lt; Dim_r             = %d                                                   &gt;\r'</span>,settings.dim_r);
0064 fprintf(<span class="string">'&lt; Dim_k             = %d                                                   &gt;\r'</span>,settings.dim_k);
0065 fprintf(<span class="string">'&lt; Constraint        = %s                                                   &gt;\r'</span>,settings.projection);
0066 fprintf(<span class="string">'&lt; Null_policy_type  = %s                                                   &gt;\r'</span>,settings.null_policy_type);
0067 fprintf(<span class="string">'&lt; Task_policy_type  = %s                                                   &gt;\r'</span>,settings.task_policy_type);
0068 
0069 <span class="comment">%% NULL SPACE POLICY GENERATION</span>
0070 <span class="keyword">switch</span> settings.null_policy_type
0071     <span class="keyword">case</span> <span class="string">'limit_cycle'</span>
0072         radius = 0.75;                                          <span class="comment">% radius of attractor</span>
0073         qdot   = 1.0;                                           <span class="comment">% angular velocity</span>
0074         w      = 1.0;                                           <span class="comment">% time scaling factor</span>
0075         f_n = @(x)(-w*[(radius-x(1,:).^2-x(2,:).^2).*x(1,:) - x(2,:)*qdot;(radius-x(1,:).^2-x(2,:).^2).*x(2,:) + x(1,:)*qdot]);
0076     <span class="keyword">case</span> <span class="string">'linear_attractor'</span>
0077         target = [0 0]';
0078         f_n    = @(x) settings.null.alpha .* (target - x);      <span class="comment">% nullspace policy</span>
0079     <span class="keyword">case</span> <span class="string">'linear'</span>
0080         w    = [1 2;3 4;-1 0];
0081         f_n    = @(x)(([x;ones(1,size(x,2))]'*w)');
0082 <span class="keyword">end</span>
0083 settings.f_n = f_n;
0084 
0085 <span class="comment">%% TASK SPACE POLICY GENERATION</span>
0086 f_b = @(N)(2*rand(1,1,N)-1);
0087 <span class="comment">% f_b    = @(x) settings.null.alpha .* (randi([-2,2]) - x);      % nullspace policy</span>
0088 settings.f_b = f_b;
0089 
0090 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0091 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0092 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0093 pause();
0094 
0095 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0096 <span class="comment">%%                              LEARN NULL SPACE COMPONENT U_n = U_ts + U_ns                          %%</span>
0097 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0098 fprintf(<span class="string">'\n\n\n&lt;=========================================================================&gt;\n'</span>);
0099 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0100 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0101 fprintf(<span class="string">'&lt; SECTION 2:       LEARNING NULL SPACE COMPONENTS                         &gt;\r'</span>);
0102 fprintf(<span class="string">'&lt; In this section,we are trying to learn U_ns out of the observations(X,U)&gt;\r'</span>);
0103 fprintf(<span class="string">'&lt; The cost function to be minimised is:                                   &gt;\r'</span>);
0104 fprintf(<span class="string">'&lt;              E[Pi_ns] = sum(||P*U - Pi_ns)||.^2                         &gt;\r'</span>);
0105 fprintf(<span class="string">'&lt; In order to achieve good performance, for each constraint, enough data  &gt;\r'</span>);
0106 fprintf(<span class="string">'&lt; samples and model complexity are necessary                              &gt;\n'</span>);
0107 fprintf(<span class="string">'\n&lt; For details please refer to:                                            &gt;\r'</span>);
0108 fprintf(<span class="string">'&lt; Towell, M. Howard, and S. Vijayakumar. IEEE International Conference    &gt;\r'</span>);
0109 fprintf(<span class="string">'&lt; Intelligent Robots and Systems, 2010.                                   &gt;\n'</span>);
0110 fprintf(1,<span class="string">'\n&lt; Start learning Null space component  ...                                &gt; \r'</span>);
0111 model = [];
0112 Ntr  = 500;
0113 Nte   = 500;
0114 A_ = orth( rand(2, 1) )';
0115 f_A = @(q)(A_);                       <span class="comment">% random constraint</span>
0116 model.num_basis = 16 ;                <span class="comment">% define the number of radial basis functions</span>
0117 settings.f_A = f_A;
0118 settings.grid_on = 1;
0119 fprintf(<span class="string">'\n&lt; Generating training dataset for learning null space components  ...     &gt;\r'</span>);
0120 settings.N = Ntr;
0121 Dtr = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0122 Xtr = Dtr.X; Ytr = Dtr.Y;
0123 Ftr = Dtr.F; Atr = Dtr.A; Ptr = Dtr.P;
0124 NStr = Dtr.NS; TStr = Dtr.TS;
0125 fprintf(1,<span class="string">'#Data (train): %5d, \r'</span>,Ntr);
0126 
0127 <span class="comment">% generate test data</span>
0128 fprintf(<span class="string">'&lt; Generating testing dataset for learning null space components   ...     &gt;\n'</span>);
0129 settings.N = Nte;
0130 Dte = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0131 Xte = Dte.X; Yte = Dte.Y;
0132 Fte = Dte.F; Ate = Dte.A; Pte = Dte.P;
0133 TSte = Dte.TS; NSte = Dte.NS;
0134 fprintf(1,<span class="string">'#Data (test): %5d, \n'</span>,Nte);
0135 
0136 <span class="comment">% generate visualisation data</span>
0137 <span class="keyword">try</span>
0138     error
0139 <span class="keyword">catch</span>
0140     Ngp  = 10; Nv = Ngp^settings.dim_x;
0141     [X1v X2v] = ndgrid(linspace(xmin(1),xmax(1),Ngp),linspace(xmin(2),xmax(2),Ngp)); Xv = [X1v(:),X2v(:)]';
0142     Fv = f_n(Xv);
0143     <span class="keyword">for</span> i = 1:Nv
0144         Av  = f_A(Xv(:,i)) ;
0145         P  = eye(2) - pinv(Av)*Av;
0146         NSv(:,i)= P*Fv(:,i) ;
0147     <span class="keyword">end</span>
0148 <span class="keyword">end</span>
0149 
0150 <span class="comment">% set up the radial basis functions</span>
0151 model.c     = <a href="../../Functions/subfunctions/generate_grid_centres.html" class="code" title="function centres = generate_grid_centres(X, num_basis )">generate_grid_centres</a> (Xtr, model.num_basis) ;      <span class="comment">% generate a grid of basis functions</span>
0152 model.s2    = mean(mean(sqrt(<a href="../../Functions/subfunctions/distances.html" class="code" title="function D = distances (A, B)">distances</a>(model.c, model.c))))^2 ;   <span class="comment">% set the variance as the mean distance between centres</span>
0153 model.phi   = @(x)<a href="../../Functions/subfunctions/phi_gaussian_rbf.html" class="code" title="function BX = phi_gaussian_rbf ( X, C, s2 )">phi_gaussian_rbf</a> ( x, model.c, model.s2 );      <span class="comment">% normalised Gaussian rbfs</span>
0154 
0155 <span class="comment">% learn the nullspace component</span>
0156 model       = <a href="../../Functions/learn_nullspace_component/learn_ncl.html" class="code" title="function model = learn_ncl(X, Y, model)">learn_ncl</a> (Xtr, Ytr, model) ;                       <span class="comment">% learn the model</span>
0157 f_ncl       = @(x) <a href="../../Functions/prediction/predict_ncl.html" class="code" title="function Unp = predict_ncl ( model, X )">predict_ncl</a> ( model, x ) ;                     <span class="comment">% set up an inference function</span>
0158 
0159 <span class="comment">% predict nullspace components</span>
0160 NSptr = f_ncl (Xtr) ;
0161 NSpte = f_ncl (Xte) ;
0162 NSpv  = f_ncl (Xv)  ;
0163 
0164 <span class="comment">% calculate errors</span>
0165 NUPEtr = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(NStr, NSptr) ;
0166 NUPEte = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(NSte, NSpte) ;
0167 YNSptr = <a href="../../Functions/evaluation/get_npe.html" class="code" title="function [umse, variance, nmse] = get_npe (U, Unp)">get_npe</a> (Ytr,  NSptr) ;
0168 YNSpte = <a href="../../Functions/evaluation/get_npe.html" class="code" title="function [umse, variance, nmse] = get_npe (U, Unp)">get_npe</a> (Yte,  NSpte) ;
0169 fprintf(1,<span class="string">'NUPE (train) = %5.3e, '</span>, NUPEtr);
0170 fprintf(1,<span class="string">'NNPE (train) = %5.3e, '</span>, YNSptr);
0171 fprintf(1,<span class="string">'\n'</span>);
0172 fprintf(1,<span class="string">'NUPE (test)  = %5.3e, '</span>, NUPEte);
0173 fprintf(1,<span class="string">'NNPE (test)  = %5.3e, '</span>, YNSpte);
0174 fprintf(1,<span class="string">'\n'</span>);
0175 
0176 <span class="comment">% visualisation</span>
0177 figNo = 2;
0178 figure(figNo),clf,hold on,grid on,box on
0179 s = .1;
0180 h(1) = quiver(Xtr(1,:), Xtr(2,:), s*Ytr (1,:), s*Ytr (2,:), 0, <span class="string">'Color'</span>, ctr,<span class="string">'LineWidth'</span>,lwtr); <span class="comment">% training data</span>
0181 h(2) = quiver(Xv (1,:) , Xv(2,:), s*NSpv(1,:), s*NSpv(2,:), 0, <span class="string">'Color'</span>, cpv,<span class="string">'LineWidth'</span>,lwpv); <span class="comment">% learnt nullspace component</span>
0182 h(3) = quiver(Xv (1,:) , Xv(2,:), s*NSv (1,:), s*NSv (2,:), 0, <span class="string">'Color'</span>,  cv,<span class="string">'LineWidth'</span>, lwv); <span class="comment">% true nullspace component</span>
0183 legend(h,<span class="string">'Data'</span>,<span class="string">'True'</span>,<span class="string">'Estimated'</span>,<span class="string">'Location'</span>,<span class="string">'Best'</span>);legend boxoff
0184 title(<span class="string">'Learning null space component'</span>);
0185 axis tight
0186 clear figNo
0187 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0188 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0189 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0190 pause();
0191 <span class="comment">%</span>
0192 
0193 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0194 <span class="comment">%%                                            LEARN CONSTRAINTS                                       %%</span>
0195 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0196 fprintf(<span class="string">'\n\n\n&lt;=========================================================================&gt;\n'</span>);
0197 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0198 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0199 fprintf(<span class="string">'&lt; SECTION 3:       LEARNING NULL SPACE CONSTRAINTS                        &gt;\r'</span>);
0200 fprintf(<span class="string">'&lt; In this section,we will start addressing state independant constraint A &gt;\r'</span>);
0201 fprintf(<span class="string">'&lt; and then state dependant constraint A(x). The exploration policy will   &gt;\r'</span>);
0202 fprintf(<span class="string">'&lt; change the performance of the learnt constraint                         &gt;\r'</span>);
0203 fprintf(<span class="string">'&lt; The cost function to be minimised is:                                   &gt;\r'</span>);
0204 fprintf(<span class="string">'&lt;                           E[A] = min(sum||A*Un||^2)                     &gt;\n'</span>);
0205 fprintf(<span class="string">'\n&lt; For details please refer to:                                            &gt;\r'</span>);
0206 fprintf(<span class="string">'&lt; H.-C. Lin, M. Howard, and S. Vijayakumar. IEEE International Conference &gt;\r'</span>);
0207 fprintf(<span class="string">'&lt; Robotics and Automation, 2015                                           &gt;\n'</span>);
0208 settings.grid_on = 0;
0209 settings.task_policy_type = <span class="string">' '</span>;
0210 settings.learn_nc       = 0;
0211 <span class="keyword">if</span> strcmp(settings.projection,<span class="string">'state_independant'</span>)
0212     fprintf(1,<span class="string">'\n&lt; Start learning state independant null space projection   ...            &gt; \n'</span>);
0213     <span class="comment">% generate visualisation data</span>
0214     settings.dim_n          = 20 ;                          <span class="comment">% number of steps in each trajactory</span>
0215     settings.nTraj          = 50 ;                          <span class="comment">% number of trajectories</span>
0216     settings.dim_exp        = 1 ;                           <span class="comment">% number of experiment to repeat</span>
0217     settings.learn_alpha    = 1;
0218     A_                      = orth( rand(2, 1) )';
0219     P                       = eye(2) - pinv(A_)*A_;
0220     f_alpha                 = @(q)(A_);                     <span class="comment">% random constraint</span>
0221     settings.f_alpha        = f_alpha;
0222     Dtr                     = [];
0223     Dte                     = [];
0224     <span class="keyword">for</span> i = 1:settings.dim_exp
0225         <span class="comment">% generating training dataset</span>
0226         fprintf(<span class="string">'\n&lt; Generating training dataset for learning constraints    ...             &gt;\r'</span>);
0227         Dtr = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0228         Xtr = Dtr.X ; Ytr = Dtr.U ; TStr = Dtr.TS ; NStr = Dtr.NS ; Ftr = Dtr.F ;
0229         fprintf(1,<span class="string">'#Data (train): %5d, \r'</span>,Ntr);
0230         <span class="comment">% generating testing data</span>
0231         fprintf(<span class="string">'&lt; Generating testing dataset for learning constraints     ...             &gt;\r'</span>);
0232         Dte = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a> (settings) ;
0233         Xte = Dte.X ; Yte = Dte.U ; TSte = Dtr.TS ; NSte = Dte.NS ; Fte = Dte.F ;
0234         fprintf(1,<span class="string">'#Data (test): %5d, \n'</span>,Nte);
0235         fprintf(1,<span class="string">'\n&lt; Experiment %d \n'</span>, i) ;
0236         fprintf(1,<span class="string">'\t Dimensionality of action space: %d \n'</span>, settings.dim_u) ;
0237         fprintf(1,<span class="string">'\t Dimensionality of task space:   %d \n'</span>, settings.dim_k) ;
0238         fprintf(1,<span class="string">'\t Dimensionality of null space:   %d \n'</span>, settings.dim_u-settings.dim_k) ;
0239         fprintf(1,<span class="string">'\t Size of the training data:      %d \n'</span>, size(Xtr,2)) ;
0240         
0241         model  = <a href="../../Functions/learn_constraint/learn_nhat.html" class="code" title="function [optimal, result] = learn_nhat (Un)">learn_nhat</a> (NStr);
0242         
0243         fprintf(1,<span class="string">'True projection:\n w =\n'</span>),      disp(P);
0244         fprintf(1,<span class="string">'Estimated projection:\n wp =\n'</span>),disp(model.P)
0245         
0246         <span class="comment">% make prediction</span>
0247         fp   = @(f)<a href="../../Functions/prediction/predict_proj.html" class="code" title="function Yp = predict_proj (F,model)">predict_proj</a> (f,model);
0248         Yptr = fp(Ftr);
0249         Ypte = fp(Fte);
0250         Ypv  = fp(Fv) ;
0251         
0252         fprintf(1,<span class="string">'\n Result %d \n'</span>) ;
0253         fprintf(1,<span class="string">'\t ===============================\n'</span> ) ;
0254         fprintf(1,<span class="string">'\t       |    NPPE   |   NPOE \n'</span> ) ;
0255         fprintf(1,<span class="string">'\t -------------------------------\n'</span> ) ;
0256         nPPE = <a href="../../Functions/evaluation/get_ppe.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe(U_t, N_p, Pi)">get_ppe</a>(Ytr, model.P, Ftr) ;
0257         nPOE = <a href="../../Functions/evaluation/get_poe.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe(U_t, N_p, Pi)">get_poe</a>(Ytr, model.P, Ftr) ;
0258         fprintf(1,<span class="string">'\t Train |  %4.2e | %4.2e  \n'</span>, nPPE,  nPOE ) ;
0259         nPPE = <a href="../../Functions/evaluation/get_ppe.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe(U_t, N_p, Pi)">get_ppe</a>(Yte, model.P, Fte) ;
0260         nPOE = <a href="../../Functions/evaluation/get_poe.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe(U_t, N_p, Pi)">get_poe</a>(Yte, model.P, Fte) ;
0261         fprintf(1,<span class="string">'\t Test  |  %4.2e | %4.2e  \n'</span>, nPPE,  nPOE ) ;
0262         fprintf(1,<span class="string">'\t ===============================\n'</span> ) ;
0263     <span class="keyword">end</span>
0264     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0265 <span class="keyword">elseif</span> strcmp(settings.projection, <span class="string">'state_dependant'</span>)
0266     
0267     fprintf(1,<span class="string">'\n&lt; Start learning state dependant null space projection   ...              &gt; \n'</span>);
0268     settings.dim_b          = 10 ;                          <span class="comment">% dimensionality of the kernel function. 16 is normally enough for a 2D problem</span>
0269     settings.dim_n          = 20 ;                          <span class="comment">% number of steps in each trajactory</span>
0270     settings.nTraj          = 50 ;                          <span class="comment">% number of trajectories</span>
0271     settings.dim_exp        = 1 ;                           <span class="comment">% number of experiment to repeat</span>
0272     settings.learn_alpha    = 1;
0273     Ntr                     = settings.dim_n*settings.nTraj;
0274     Nte                     = Ntr;
0275     Dtr                     = [];
0276     Dte                     = [];
0277     <span class="keyword">for</span> i = 1:settings.dim_exp
0278         fprintf(<span class="string">'&lt; Generating training dataset for learning constraints     ...             &gt;\r'</span>);
0279         Dtr = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0280         Xtr = Dtr.X ; Ytr = Dtr.U ; TStr = Dtr.TS ; NStr = Dtr.NS ; Ftr = Dtr.F ;
0281         fprintf(1,<span class="string">'#Data (train): %5d, \r'</span>,Ntr);
0282         <span class="comment">% generating testing data</span>
0283         fprintf(<span class="string">'&lt; Generating testing dataset learning constraints      ...                 &gt;\r'</span>);
0284         Dte = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a> (settings) ;
0285         Xte = Dte.X ; Yte = Dte.U ; TSte = Dte.TS ; NSte = Dte.NS ; Fte = Dte.F ;
0286         fprintf(1,<span class="string">'#Data (test): %5d, \n'</span>,Nte);
0287         fprintf(1,<span class="string">'\n Experiment %d \n'</span>, i) ;
0288         fprintf(1,<span class="string">'\t Dimensionality of action space: %d \n'</span>, settings.dim_u) ;
0289         fprintf(1,<span class="string">'\t Dimensionality of task space:   %d \n'</span>, settings.dim_k) ;
0290         fprintf(1,<span class="string">'\t Dimensionality of null space:   %d \n'</span>, settings.dim_u-settings.dim_k) ;
0291         fprintf(1,<span class="string">'\t Dimensionality of kernel:       %d \n'</span>, settings.dim_b) ;
0292         fprintf(1,<span class="string">'\t Size of the training data:      %d \n'</span>, size(Xtr,2)) ;
0293         <span class="comment">%         fprintf(1,'\t Random constraint:  [%4.2f, %4.2f] \n', settings.alpha(1), settings.alpha(2)) ;</span>
0294         fprintf(1,<span class="string">'\n Learning state-dependent constraint vectors... \n'</span>) ;
0295         
0296         model_alpha_ccl  = <a href="../../Functions/learn_constraint/learn_alpha_ccl.html" class="code" title="function [optimal] = learn_alpha_ccl (Un, X, options)">learn_alpha_ccl</a> (NStr, Xtr, settings);
0297         
0298         ppe.alpha_ccl.tr = <a href="../../Functions/evaluation/get_ppe_alpha.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe_alpha (f_proj, X_t, Pi, NS_t)">get_ppe_alpha</a> (model_alpha_ccl.f_proj, Xtr, Ftr, NStr) ;
0299         ppe.alpha_ccl.te = <a href="../../Functions/evaluation/get_ppe_alpha.html" class="code" title="function [nPPE, vPPE, uPPE] = get_ppe_alpha (f_proj, X_t, Pi, NS_t)">get_ppe_alpha</a> (model_alpha_ccl.f_proj, Xte, Fte, NSte) ;
0300         poe.alpha_ccl.tr = <a href="../../Functions/evaluation/get_poe_alpha.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe_alpha (f_proj, X, NS_t)">get_poe_alpha</a> (model_alpha_ccl.f_proj, Xtr, NStr) ;
0301         poe.alpha_ccl.te = <a href="../../Functions/evaluation/get_poe_alpha.html" class="code" title="function [nPOE, vPOE, uPOE] = get_poe_alpha (f_proj, X, NS_t)">get_poe_alpha</a> (model_alpha_ccl.f_proj, Xte, NSte) ;
0302         
0303         fprintf(1,<span class="string">'\n Result %d \n'</span>) ;
0304         fprintf(1,<span class="string">'\t ===============================\n'</span> ) ;
0305         fprintf(1,<span class="string">'\t       |    NPPE   |   NPOE \n'</span> ) ;
0306         fprintf(1,<span class="string">'\t -------------------------------\n'</span> ) ;
0307         fprintf(1,<span class="string">'\t Train |  %4.2e | %4.2e  \n'</span>, ppe.alpha_ccl.tr,  poe.alpha_ccl.tr ) ;
0308         fprintf(1,<span class="string">'\t Test  |  %4.2e | %4.2e  \n'</span>, ppe.alpha_ccl.te,  poe.alpha_ccl.te ) ;
0309         fprintf(1,<span class="string">'\t ===============================\n'</span> ) ;
0310     <span class="keyword">end</span>
0311 <span class="keyword">end</span>
0312 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0313 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0314 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0315 pause();
0316 
0317 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0318 <span class="comment">%%                              LEARN PARAMETRIC NULL SPACE POLICY MODEL                              %%</span>
0319 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0320 <span class="comment">%% Learn null space policy %%</span>
0321 fprintf(<span class="string">'\n\n\n&lt;=========================================================================&gt;\n'</span>);
0322 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0323 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0324 fprintf(<span class="string">'&lt; SECTION 4:       LEARNING NULL SPACE POLICY                             &gt;\r'</span>);
0325 fprintf(<span class="string">'&lt; This section is for learning null space policy models. The methods we   &gt;\r'</span>);
0326 fprintf(<span class="string">'&lt; use are parametric model and locally weighted parametric model          &gt;\r'</span>);
0327 fprintf(<span class="string">'&lt; The cost function to be minimised is:                                   &gt;\r'</span>);
0328 fprintf(<span class="string">'&lt;                  E[Pi] = min(sim||U_ns - U_ns^2*Pi||^2)                 &gt;\r'</span>);
0329 fprintf(<span class="string">'&lt; To achiev a better unconstrained null space policy, more constraints    &gt;\r'</span>);
0330 fprintf(<span class="string">'&lt; need to be demonstrated in the training dataset                         &gt;\n'</span>);
0331 fprintf(<span class="string">'\n&lt; For details please refer to:                                            &gt;\r'</span>);
0332 fprintf(<span class="string">'&lt; Howard, Matthew, et al. &quot;A novel method for learning policies from      &gt;\r'</span>);
0333 fprintf(<span class="string">'&lt; variable constraint data.&quot; Autonomous Robots 27.2 (2009): 105-121.      &gt;\n'</span>);
0334 fprintf(<span class="string">'\n&lt; Start learning null space policy   ...                                 &gt; \n'</span>);
0335 Dtr     = [];
0336 Dte     = [];
0337 settings.grid_on = 1;
0338 <span class="keyword">if</span> strcmp(settings.projection, <span class="string">'state_independant'</span>)
0339     f_A = @(q)(orth( rand(2, 1) )');                       <span class="comment">% random constraint</span>
0340 <span class="keyword">elseif</span> strcmp(settings.projection, <span class="string">'state_dependant'</span>)
0341     f_A = @(q)([2*randi([-10,10])*q(1),-1]);            <span class="comment">% parabola constraint</span>
0342 <span class="keyword">end</span>
0343 settings.f_A = f_A;
0344 Ntr          = 500;
0345 Nte          = 500;
0346 fprintf(<span class="string">'\n&lt; Generating training dataset for learning null space constraints  ...    &gt;\n'</span>);
0347 settings.N = Ntr;
0348 Dtr = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0349 Xtr = Dtr.X; Ytr = Dtr.Y;
0350 Ftr = Dtr.F; Atr = Dtr.A; Ptr = Dtr.P;
0351 NStr = Dtr.NS; TStr = Dtr.TS;
0352 fprintf(1,<span class="string">'#Data (train): %5d, \r'</span>,Ntr);
0353 
0354 <span class="comment">% generate test data</span>
0355 fprintf(<span class="string">'\n&lt; Generating testing dataset for learning null space constraints   ...    &gt;\n'</span>);
0356 settings.N = Nte;
0357 Dte = <a href="../../Functions/data_generation/generate_data_ccl.html" class="code" title="function data = generate_data_ccl (settings)">generate_data_ccl</a>(settings);
0358 Xte = Dte.X; Yte = Dte.Y;
0359 Fte = Dte.F; Ate = Dte.A; Pte = Dte.P;
0360 TSte = Dte.TS; NSte = Dte.NS;
0361 
0362 fprintf(1,<span class="string">'#Data (test): %5d, \n'</span>,Nte);
0363 
0364 <span class="keyword">try</span>
0365     error
0366 <span class="keyword">catch</span>
0367     fprintf(1,<span class="string">'\n&lt; Start learning Null space policy with parametric model  ...             &gt; \n'</span>);
0368     Ngp  = 10; Nv = Ngp^settings.dim_x;
0369     [X1v X2v] = ndgrid(linspace(xmin(1),xmax(1),Ngp),linspace(xmin(2),xmax(2),Ngp)); Xv = [X1v(:),X2v(:)]';
0370     Fv = f_n(Xv);
0371 <span class="keyword">end</span>
0372 <span class="comment">% set up regression model</span>
0373 model = [];
0374 model.w = [];
0375 cmax = xmax+.1;
0376 cmin = xmin-.1;
0377 Ngp  = 10; Nc = Ngp^settings.dim_x;
0378 [c1,c2] = ndgrid(linspace(cmin(1),cmax(1),Ngp),linspace(cmin(2),cmax(2),Ngp)); c = [c1(:),c2(:)]';
0379 s2   = 1.0;
0380 model.phi = @(x)<a href="../../Functions/subfunctions/phi_gaussian_rbf.html" class="code" title="function BX = phi_gaussian_rbf ( X, C, s2 )">phi_gaussian_rbf</a> ( x, c, s2 );
0381 <span class="comment">%     model.phi = @(x)phi_linear ( x );</span>
0382 
0383 <span class="comment">% train parametric model</span>
0384 model = <a href="../../Functions/learn_policy/learn_ccl_pi.html" class="code" title="function model = learn_ccl_pi(X,Y,model)">learn_ccl_pi</a>(Xtr,NStr,model); fp = @(x)<a href="../../Functions/prediction/predict_linear.html" class="code" title="function Yp = predict_linear(X,model)">predict_linear</a>(x,model);
0385 
0386 <span class="comment">% predict training data</span>
0387 Fptr = fp(Xtr);
0388 
0389 <span class="comment">% compute training error</span>
0390 NUPEtr = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(Ftr,Fptr);
0391 fprintf(1,<span class="string">'NUPE (train) = %5.2e, '</span>,NUPEtr);
0392 NCPEtr = <a href="../../Functions/evaluation/get_ncpe.html" class="code" title="function [ncpe, v, mse] = get_ncpe(F, Fp, P)">get_ncpe</a>(NStr,Fptr,Ptr);
0393 fprintf(1,<span class="string">'NCPE (train) = %5.2e, '</span>,NCPEtr);
0394 
0395 <span class="comment">% predict test data</span>
0396 Fpte = fp(Xte);
0397 
0398 <span class="comment">% compute test error</span>
0399 NUPEte = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(Fte,Fpte);
0400 fprintf(1,<span class="string">'NUPE (test) = %5.2e, '</span>,NUPEte);
0401 NCPEte = <a href="../../Functions/evaluation/get_ncpe.html" class="code" title="function [ncpe, v, mse] = get_ncpe(F, Fp, P)">get_ncpe</a>(NSte,Fpte,Pte);
0402 fprintf(1,<span class="string">'NCPE (test) = %5.2e'</span>,NCPEte);
0403 fprintf(1,<span class="string">'\n'</span>);
0404 
0405 <span class="comment">% visualisation</span>
0406 figNo = 4;
0407 figure(figNo),clf,hold on,grid on,box on
0408 <span class="comment">% visualise the training data</span>
0409 s = .1;
0410 h(1)=quiver(Xtr(1,:),Xtr(2,:),s* NStr(1,:),s* NStr(2,:),0,<span class="string">'Color'</span>, ctr,<span class="string">'LineWidth'</span>, lwtr);
0411 <span class="comment">% visualise the fit</span>
0412 <span class="comment">% predict visualisation data</span>
0413 Fpv = fp(Xv);
0414 <span class="comment">% visualise the fit</span>
0415 h(2)=quiver(Xv(1,:),Xv(2,:),s*Fpv(1,:),s*Fpv(2,:),0,<span class="string">'Color'</span>,cpv,<span class="string">'LineWidth'</span>,lwpv);
0416 h(3)=quiver(Xv(1,:),Xv(2,:),s* Fv(1,:),s* Fv(2,:),0,<span class="string">'Color'</span>, cv,<span class="string">'LineWidth'</span>, lwv);
0417 legend(h,<span class="string">'Data'</span>,<span class="string">'Estimated'</span>,<span class="string">'True'</span>,<span class="string">'Location'</span>,<span class="string">'Best'</span>);legend boxoff
0418 title(<span class="string">'Learning null space policy with linear parametric model'</span>)
0419 axis tight
0420 pause();
0421 
0422 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0423 <span class="comment">%%                              LEARN LOCALLY WEIGHTED LINEAR POLICY MODEL                            %%</span>
0424 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0425 fprintf(1,<span class="string">'\n&lt; Start learning Null space policy with locally weighted  model   ...     &gt; \n'</span>);
0426 model = [];
0427 Ngp  = 5; Nc = Ngp^settings.dim_x;
0428 [c1,c2] = ndgrid(linspace(cmin(1),cmax(1),Ngp),linspace(cmin(2),cmax(2),Ngp)); c = [c1(:),c2(:)]';
0429 s2 = 1;
0430 model = [];
0431 model.W   = @(x)<a href="../../Functions/subfunctions/phi_gaussian_rbf.html" class="code" title="function BX = phi_gaussian_rbf ( X, C, s2 )">phi_gaussian_rbf</a>( x, c, s2 );
0432 <span class="comment">% model.phi = @(x)phi_linear( x );</span>
0433 model.phi = @(x)<a href="../../Functions/subfunctions/phi_gaussian_rbf.html" class="code" title="function BX = phi_gaussian_rbf ( X, C, s2 )">phi_gaussian_rbf</a> ( x, c, s2 );
0434 
0435 <span class="comment">% train the model</span>
0436 model = <a href="../../Functions/learn_policy/learn_lwccl.html" class="code" title="function model = learn_lwccl(X,Y,model)">learn_lwccl</a>(Xtr,NStr,model); fp = @(x)<a href="../../Functions/prediction/predict_local_linear.html" class="code" title="function Yp = predict_local_linear(X,model)">predict_local_linear</a>(x,model);
0437 
0438 <span class="comment">% predict training data</span>
0439 Fptr = fp(Xtr);
0440 
0441 <span class="comment">% compute training error</span>
0442 NUPEtr = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(Ftr,Fptr);
0443 fprintf(1,<span class="string">'NUPE (train) = %5.2e, '</span>,NUPEtr);
0444 NCPEtr = <a href="../../Functions/evaluation/get_ncpe.html" class="code" title="function [ncpe, v, mse] = get_ncpe(F, Fp, P)">get_ncpe</a>(NStr,Fptr,Ptr);
0445 fprintf(1,<span class="string">'NCPE (train) = %5.2e, '</span>,NCPEtr);
0446 
0447 <span class="comment">% predict test data</span>
0448 Fpte = fp(Xte);
0449 
0450 <span class="comment">% compute test error</span>
0451 NUPEte = <a href="../../Functions/evaluation/get_nupe.html" class="code" title="function [nupe, v, mse] = get_nupe(F, Fp)">get_nupe</a>(Fte,Fpte);
0452 fprintf(1,<span class="string">'NUPE (test) = %5.2e, '</span>,NUPEte);
0453 NCPEte = <a href="../../Functions/evaluation/get_ncpe.html" class="code" title="function [ncpe, v, mse] = get_ncpe(F, Fp, P)">get_ncpe</a>(NSte,Fpte,Pte);
0454 fprintf(1,<span class="string">'NCPE (test) = %5.2e'</span>,NCPEte);
0455 fprintf(1,<span class="string">'\n'</span>);
0456 
0457 <span class="comment">% visualisation</span>
0458 figNo = 5;
0459 figure(figNo),clf,hold on,grid on,box on
0460 <span class="comment">% visualise the training data</span>
0461 s = .1;
0462 h(1)=quiver(Xtr(1,:),Xtr(2,:),s* NStr(1,:),s* NStr(2,:),0,<span class="string">'Color'</span>, ctr,<span class="string">'LineWidth'</span>, lwtr);
0463 <span class="comment">% visualise the fit</span>
0464 <span class="comment">% predict visualisation data</span>
0465 Fpv = fp(Xv);
0466 <span class="comment">% visualise the fit</span>
0467 h(2)=quiver(Xv(1,:),Xv(2,:),s*Fpv(1,:),s*Fpv(2,:),0,<span class="string">'Color'</span>,cpv,<span class="string">'LineWidth'</span>,lwpv);
0468 h(3)=quiver(Xv(1,:),Xv(2,:),s* Fv(1,:),s* Fv(2,:),0,<span class="string">'Color'</span>, cv,<span class="string">'LineWidth'</span>, lwv);
0469 legend(h,<span class="string">'Data'</span>,<span class="string">'Estimated'</span>,<span class="string">'True'</span>,<span class="string">'Location'</span>,<span class="string">'Best'</span>);legend boxoff
0470 title(<span class="string">'Learning null space policy with locally weighted parametric model'</span>)
0471 axis tight
0472 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0473 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0474 fprintf(<span class="string">'&lt;=========================================================================&gt;\n'</span>);
0475 pause();
0476 close all;
0477 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 24-Jul-2017 16:09:11 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>